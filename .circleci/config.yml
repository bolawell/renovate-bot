---
version: 2.1

jobs:
  run-renovate:
    docker:
      - image: renovate/renovate:29.17.4
    resource_class: small
    steps:
      - checkout
      - run:
          name: Run renovate
          command: |
            export GPG_KEY=$(echo "${GPG_KEY_BASE64}" | base64 --decode)
            renovate

workflows:
  version: 2
  run-renovate:
    jobs:
      - run-renovate:
          context:
            - aws_svc_renovate
            - renovate-bot
          filters:
            branches:
              only: master
  run-renovate-on-schedule:
    triggers:
      - schedule:
          # Monday to Friday, at 9:00, 12:00, 15:00
          cron: "0 9,12,15 * * 1-5"
          filters:
            branches:
              only:
                - master
    jobs:
      - run-renovate:
          context:
            - aws_svc_renovate
            - renovate-bot
          filters:
            branches:
              only: master
