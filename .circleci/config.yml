---
version: 2.1

jobs:
  run-renovate:
    docker:
      - image: renovate/renovate:32.99.8
    resource_class: small
    steps:
      - checkout
      - run:
          name: Run renovate
          command: |
            export GPG_KEY=$(echo "${GPG_KEY_BASE64}" | base64 --decode)
            renovate

workflows:
  version: 2
  run-renovate:
    jobs:
      - run-renovate:
          context:
            - aws_svc_renovate
            - renovate-bot
          filters:
            branches:
              only: master
  run-renovate-on-schedule:
    when:
      and:
        - equal: [ scheduled_pipeline, << pipeline.trigger_source >> ]
    jobs:
      - run-renovate:
          context:
            - aws_svc_renovate
            - renovate-bot
          filters:
            branches:
              only: master
